<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cadastro de Institui√ß√£o</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Protest+Guerrilla&display=swap");
      @import url("https://fonts.googleapis.com/css2?family=Comic+Relief:wght@400;700&display=swap");

      body {
        background-color: #eacceb;
      }

      .protest-guerrilla-regular {
        font-family: "Protest Guerrilla", sans-serif;
        font-weight: 800;
        text-align: center;
        font-size: 9vh;
        background: linear-gradient(45deg, #cd7ccf, #3a0e66);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .comic-relief-regular {
        font-family: "Comic Relief", system-ui;
      }

      .submit {
        font-family: "Protest Guerrilla", sans-serif;
        background-color: #b2b0b3;
        color: #4e4e4e;
        font-weight: 800;
      }

      .submit:hover {
        background-color: #e788e9;
        color: #3a0e66;
      }

      form {
        margin-top: 10%;
        display: flex;
        flex-direction: column;
        height: auto;
      }

      .mid {
        display: flex;
        justify-content: center;
        width: 80%;
      }

      .col {
        display: flex;
        flex-direction: column;
      }

      input,
      select {
        width: 85%;
        height: 5vh;
        margin-bottom: 4%;
        border-radius: 15px;
        padding: 5px 10px;
      }

      .container {
        max-width: 40%;
      }

      .cssbuttons-io {
        position: absolute;
        margin: 1.7%;
        font-size: 18px;
        border-radius: 0.9em;
        border: none;
        background: linear-gradient(to right, #8e2de2, #4a00e0);
        color: white;
      }

      .cssbuttons-io span {
        padding: 0.5em 1em;
      }
    </style>
  </head>

  <body>
    <nav>
      <a href="index.php">
        <button class="cssbuttons-io">
          <span class="material-symbols-outlined">‚Üê</span>
        </button>
      </a>
    </nav>

    <main class="container">
      <h1 class="protest-guerrilla-regular">Cadastro de Institui√ß√£o</h1>
      <form action="cadastro_instituicao.php" method="post">
        <label class="comic-relief-regular" for="nome"
          >Nome da Institui√ß√£o</label
        >
        <input type="text" name="nome" id="nome" required />

        <label class="comic-relief-regular" for="cnpj">CNPJ</label>
        <input type="text" name="cnpj" id="cnpj" maxlength="18" required />

        <label class="comic-relief-regular" for="certificacao"
          >Certifica√ß√£o / Alvar√°</label
        >
        <input type="text" name="certificacao" id="certificacao" required />

        <div class="mid">
          <div class="col">
            <label class="comic-relief-regular" for="rua">Rua</label>
            <input type="text" name="rua" id="rua" required />
          </div>

          <div class="col">
            <label class="comic-relief-regular" for="num">N√∫mero</label>
            <input type="number" name="num" id="num" required />
          </div>
        </div>

        <div class="mid">
          <div class="col">
            <label class="comic-relief-regular" for="uf">UF</label>
            <select
              class="form-select"
              id="uf"
              name="uf"
              required
              style="width: 80%"
            >
              <option value="">Selecione</option>
              <option value="AC">AC</option>
              <option value="AL">AL</option>
              <option value="AP">AP</option>
              <option value="AM">AM</option>
              <option value="BA">BA</option>
              <option value="CE">CE</option>
              <option value="DF">DF</option>
              <option value="ES">ES</option>
              <option value="GO">GO</option>
              <option value="MA">MA</option>
              <option value="MT">MT</option>
              <option value="MS">MS</option>
              <option value="MG">MG</option>
              <option value="PA">PA</option>
              <option value="PB">PB</option>
              <option value="PR">PR</option>
              <option value="PE">PE</option>
              <option value="PI">PI</option>
              <option value="RJ">RJ</option>
              <option value="RN">RN</option>
              <option value="RS">RS</option>
              <option value="RO">RO</option>
              <option value="RR">RR</option>
              <option value="SC">SC</option>
              <option value="SP">SP</option>
              <option value="SE">SE</option>
              <option value="TO">TO</option>
            </select>
          </div>

          <div class="col">
            <label class="comic-relief-regular" for="cidade">Cidade</label>
            <select
              class="form-select"
              id="cidade"
              name="cidade"
              required
              style="width: 80%"
            >
              <option value="">Selecione o estado primeiro</option>
            </select>
          </div>
        </div>

        <input class="submit" type="submit" value="Cadastrar" />
      </form>
    </main>

    <script>
      // üîπ M√°scara CNPJ
      document.getElementById("cnpj").addEventListener("input", function (e) {
        let v = e.target.value.replace(/\D/g, "");
        if (v.length > 14) v = v.slice(0, 14);
        if (v.length > 12)
          v = v.replace(
            /^(\d{2})(\d{3})(\d{3})(\d{4})(\d{0,2}).*/,
            "$1.$2.$3/$4-$5"
          );
        else if (v.length > 8)
          v = v.replace(/^(\d{2})(\d{3})(\d{3})(\d{0,4}).*/, "$1.$2.$3/$4");
        else if (v.length > 5)
          v = v.replace(/^(\d{2})(\d{3})(\d{0,3}).*/, "$1.$2.$3");
        else if (v.length > 2) v = v.replace(/^(\d{2})(\d{0,3}).*/, "$1.$2");
        e.target.value = v;
      });

      // üîπ API IBGE - cidades
      const ufSelect = document.getElementById("uf");
      const cidadeSelect = document.getElementById("cidade");

      ufSelect.addEventListener("change", async () => {
        const uf = ufSelect.value;
        cidadeSelect.innerHTML = '<option value="">Carregando...</option>';

        if (!uf) {
          cidadeSelect.innerHTML =
            '<option value="">Selecione o estado primeiro</option>';
          return;
        }

        try {
          const response = await fetch(
            `https://servicodados.ibge.gov.br/api/v1/localidades/estados/${uf}/municipios`
          );
          const cidades = await response.json();
          cidadeSelect.innerHTML = '<option value="">Selecione</option>';
          cidades.forEach((c) => {
            const option = document.createElement("option");
            option.value = c.nome;
            option.textContent = c.nome;
            cidadeSelect.appendChild(option);
          });
        } catch (error) {
          cidadeSelect.innerHTML =
            '<option value="">Erro ao carregar cidades</option>';
          console.error("Erro ao carregar cidades:", error);
        }
      });
    </script>
  </body>
</html>
