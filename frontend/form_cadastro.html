<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cadastro</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@400"
    />

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Protest+Guerrilla&display=swap");
      @import url("https://fonts.googleapis.com/css2?family=Comic+Relief:wght@400;700&display=swap");

      .comic-relief-regular {
        font-family: "Comic Relief", system-ui;
      }

      .protest-guerrilla-regular {
        font-family: "Protest Guerrilla", sans-serif;
        font-weight: 800;
        text-align: center;
        font-size: 10vh;
        background: linear-gradient(45deg, #cd7ccf, #3a0e66);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      html {
        background-image: url(../backend/img/fundo.png);
      }
      body {
        background-color: #f9c4d2c2;
        min-height: 100vh;
      }

      .submit,
      .inst-btn {
        font-family: "Protest Guerrilla", sans-serif;
        background-color: #b2b0b3;
        color: #4e4e4e;
        font-weight: 800;
        border-radius: 15px;
        border: solid 1.5px black;
        height: 5vh;
        width: 90%;
        margin-bottom: 4%;
        transition: 0.4s;
      }

      .submit:hover,
      .inst-btn:hover {
        background-color: #e788e9;
        color: #3a0e66;
        border-color: #5a189b;
        transform: scale(1.03);
      }

      form {
        height: auto;
        margin-top: 5%;
        display: flex;
        flex-direction: column;
      }

      input,
      select {
        width: 90%;
        height: 5vh;
        margin-bottom: 4%;
        border-radius: 15px;
        border: solid 1.5px black;
      }

      .container {
        max-width: 35%;
      }

      .cssbuttons-io {
        position: absolute;
        font-family: inherit;
        margin: 5%;
        margin-top: 1.5%;
        font-size: 18px;
        letter-spacing: 0.05em;
        border-radius: 0.9em;
        cursor: pointer;
        border: none;
        background: linear-gradient(to right, #8e2de2, #4a00e0);
        color: ghostwhite;
        overflow: hidden;
      }

      .cssbuttons-io svg {
        width: 1em;
        height: 1em;
        margin-right: 0.5em;
      }

      .cssbuttons-io span {
        position: relative;
        z-index: 10;
        transition: color 0.4s;
        display: inline-flex;
        align-items: center;
        padding: 0.5em 1em 0.5em 1em;
      }

      .cssbuttons-io::before,
      .cssbuttons-io::after {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
      }

      .cssbuttons-io::before {
        content: "";
        background: #000;
        width: 120%;
        left: -10%;
        transform: skew(30deg);
        transition: transform 0.4s cubic-bezier(0.3, 1, 0.8, 1);
      }

      .cssbuttons-io:hover::before {
        transform: translate3d(100%, 0, 0);
      }

      .cssbuttons-io:active {
        transform: scale(0.95);
      }
    </style>
  </head>

  <body>
    <main>
      <a href="index.html">
        <button class="cssbuttons-io">
          <span class="material-symbols-outlined">arrow_left_alt</span>
        </button>
      </a>

      <div class="container">
        <h1 class="protest-guerrilla-regular">Cadastro</h1>

        <!-- BOTÃO INSTITUIÇÃO -->
        <div class="col">
          <button
            class="inst-btn"
            type="button"
            onclick="window.location.href='form_cadastro_inst.html'"
          >
            Sou uma Instituição
          </button>
        </div>

        <form action="../backend/cadastro.php" method="post">
          <label class="comic-relief-regular" for="nome">Nome Completo</label>
          <input type="text" name="nome" id="nome" required />

          <label class="comic-relief-regular" for="cpf">CPF </label>
          <input type="text" name="cpf" id="cpf" required />

          <label class="comic-relief-regular" for="telefone">Telefone</label>
          <input
            type="tel"
            name="telefone"
            id="fone"
            maxlength="15"
            placeholder="(xx) xxxxx-xxxx"
            required
          />

          <label class="comic-relief-regular" for="datanasc">
            Data de Nascimento
          </label>
          <input
            type="date"
            name="data_nascimento"
            id="datanasc"
            max="2020-12-31"
            required
          />

          <label class="comic-relief-regular" for="uf">UF</label>
          <select id="uf" name="uf" required onchange="carregarCidades()">
            <option value="">Selecione</option>
            <option value="AC">AC</option>
            <option value="AL">AL</option>
            <option value="AP">AP</option>
            <option value="AM">AM</option>
            <option value="BA">BA</option>
            <option value="CE">CE</option>
            <option value="DF">DF</option>
            <option value="ES">ES</option>
            <option value="GO">GO</option>
            <option value="MA">MA</option>
            <option value="MT">MT</option>
            <option value="MS">MS</option>
            <option value="MG">MG</option>
            <option value="PA">PA</option>
            <option value="PB">PB</option>
            <option value="PR">PR</option>
            <option value="PE">PE</option>
            <option value="PI">PI</option>
            <option value="RJ">RJ</option>
            <option value="RN">RN</option>
            <option value="RS">RS</option>
            <option value="RO">RO</option>
            <option value="RR">RR</option>
            <option value="SC">SC</option>
            <option value="SP">SP</option>
            <option value="SE">SE</option>
            <option value="TO">TO</option>
          </select>

          <label class="comic-relief-regular" for="cidade">Cidade</label>
          <select id="cidade" name="cidade" required disabled>
            <option value="">Selecione a UF primeiro</option>
          </select>

          <label class="comic-relief-regular" for="email">Email</label>
          <input type="email" name="email" id="email" required />

          <label class="comic-relief-regular" for="senha">Senha</label>
          <input type="password" name="senha" id="senha" required />

          <label class="comic-relief-regular" for="confsenha">
            Confirme sua Senha</label
          >
          <input type="password" name="confsenha" id="confsenha" required />

          <input class="submit" type="submit" value="Enviar" />
        </form>
      </div>
    </main>

    <script>
      // Máscara telefone
      document.getElementById("fone").addEventListener("input", function (e) {
        let value = e.target.value.replace(/\D/g, "");
        if (value.length > 10) {
          value = value.replace(/^(\d{2})(\d{5})(\d{4}).*/, "($1) $2-$3");
        } else if (value.length > 6) {
          value = value.replace(/^(\d{2})(\d{4})(\d{0,4}).*/, "($1) $2-$3");
        } else if (value.length > 2) {
          value = value.replace(/^(\d{2})(\d{0,5})/, "($1) $2");
        } else {
          value = value.replace(/^(\d*)/, "($1");
        }
        e.target.value = value;
      });

      // Máscara CPF
      const cpfInput = document.getElementById("cpf");
      cpfInput.addEventListener("input", function (e) {
        let v = e.target.value.replace(/\D/g, "");
        if (v.length > 11) v = v.slice(0, 11);
        if (v.length > 9) {
          v = v.replace(/^(\d{3})(\d{3})(\d{3})(\d{2}).*/, "$1.$2.$3-$4");
        } else if (v.length > 6) {
          v = v.replace(/^(\d{3})(\d{3})(\d{0,3}).*/, "$1.$2.$3");
        } else if (v.length > 3) {
          v = v.replace(/^(\d{3})(\d{0,3}).*/, "$1.$2");
        }
        e.target.value = v;
      });

      cpfInput.addEventListener("keydown", function (e) {
        const allowed = [
          "Backspace",
          "ArrowLeft",
          "ArrowRight",
          "Delete",
          "Tab",
        ];
        if (allowed.includes(e.key)) return;
        if (e.key.length === 1 && /\D/.test(e.key)) e.preventDefault();
      });

      // Carregar cidades
      async function carregarCidades() {
        const uf = document.getElementById("uf").value;
        const cidadeSelect = document.getElementById("cidade");

        cidadeSelect.disabled = true;
        cidadeSelect.innerHTML = '<option value="">Carregando...</option>';

        if (!uf) {
          cidadeSelect.innerHTML =
            '<option value="">Selecione a UF primeiro</option>';
          cidadeSelect.disabled = true;
          return;
        }

        try {
          const response = await fetch(
            `https://servicodados.ibge.gov.br/api/v1/localidades/estados/${uf}/municipios`
          );
          const data = await response.json();

          cidadeSelect.innerHTML =
            '<option value="">Selecione a Cidade</option>';
          data.forEach((cidade) => {
            const option = document.createElement("option");
            option.value = cidade.nome;
            option.textContent = cidade.nome;
            cidadeSelect.appendChild(option);
          });

          cidadeSelect.disabled = false;
        } catch (error) {
          cidadeSelect.innerHTML =
            '<option value="">Erro ao carregar cidades</option>';
          cidadeSelect.disabled = true;
        }
      }
    </script>
  </body>
</html>
